{% extends "base.html" %}

{% block content %}

<br><br>
{% if current_user.is_authenticated %}
<h2>My Cart:</h2>
<!--table of everything in the cart-->
<table class='table table-hover table-bordered container'>
  <thead class="quokka-brown">
    <tr>
      <th scope="col">Seller ID</th>
      <th scope="col">Product ID</th>
      <th scope="col">Quantity</th>
      <th scope="col">Unit Price</th>
      <th scope="col">Saved For Later</th>
      <th scope="col">Remove</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr>
        <td>{{item.sid}}</td>
        <td>{{item.pid}}</td>
        <td>{{item.quantity}} <form action="{{ url_for('cart.cart_update_quantity')}}"
          method="POST">
          Change Quantity: <input type="number" name="quantity">
          <input type="hidden" name="product_id" value="{{item.pid}}"/> 
          <input type="hidden" name="seller_id" value="{{item.sid}}"/> 
          <input type="submit" value="Update">
      </form></td>
        <td>{{item.price}}</td>
        <td>{{item.saved_for_later}}</td>
        <td>
          <form action="{{ url_for('cart.cart_remove', seller_id=item.sid, product_id=item.pid)}}"
            method="POST">
            <input type="submit" value="Remove"/> 
          </form></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your cart!</p>
{% endif %}
<h2> Total Price: ${{totalprice}}</h2>
<form action="{{ url_for('cart.cart_submit')}}"
            method="POST">
            <input type="submit" value="Submit Order"/>
</form>
<form action="{{ url_for('cart.cart_viewOrders')}}">
            <input type="submit" value="View Submitted Orders"/>
</form>
</div>
<!--shows popup on duplicate entry, non-positive quantity, or order>balance-->
{% with messages = get_flashed_messages() %}
      {% if messages %}
          <div id="popup" class="popup">
              <div class="popup-content">
                  <span class="close" onclick="closePopup()">&times;</span>
                  <ul>
                      {% for message in messages %}
                          <li>{{ message }}</li>
                      {% endfor %}
                  </ul>
              </div>
          </div>
      {% endif %}
  {% endwith %}

  <script>
      function closePopup() {
          document.getElementById('popup').style.display = 'none';
      }
  </script>
  <!--add place to input coupon code for discount and add another boolean parameter-->
  <!--to ensure you can't use that code god i want to kms-->
{% endblock %}
