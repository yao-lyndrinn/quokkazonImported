{% extends "base.html" %}

{% block content %}
{% if current_user.is_authenticated %}
<br>
<!-- Scroll Button -->
<script> 
  function scrolldiv(id) { 
    window.scroll(0, 
    findPosition(document.getElementById(id))); 
  } 
  function findPosition(obj) { 
    var currenttop = 0; 
    if (obj.offsetParent) { 
      do { 
        currenttop += obj.offsetTop; 
      } while ((obj = obj.offsetParent)); 
      return [currenttop]; 
    } 
  } 
</script> 
  

<h1>My Feedback History</h1>
<br>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<script>
  $(document).ready(function(){
    // initialize a DataTable sorted by the 'Time Added or Updated' column 
    // in reverse chronological order by default.
    new DataTable($('#sortable_products'), {
      order: [[3, 'asc']] 
    });
    new DataTable($('#sortable_sellers'), {
      order: [[3, 'asc']] 
    });
  })
</script>

  <div id="products">
  <h3>For Products:</h3>
  <button onclick="scrolldiv('sellers')">Scroll to Seller Feedback</button> 
  <table class='table table-hover table-bordered container' id="sortable_products">
    <thead class="quokka-brown">
      <tr>
        <th scope="col">Product Name</th>
        <th scope="col">Rating</th>
        <th scope="col">Review</th>
        <th scope="col">Time Added or Updated</th>
        <th scope="col">Edit</th>
      </tr>
    </thead>
    <tbody>
      {% for item in pfeedback %}
        <tr>
          <td>
            <a href="{{ url_for('products.product_detail',product_id=item.pid) }}">{{item.name}}</a>
          </td>
          <td>{{item.rating}}</td>
          <td>{{item.review}}</td>
          <td>{{humanize_time(item.date_time)}}</td>
          <td>
            <form action="{{ url_for('feedback.product_feedback_edit', product_id=item.pid) }}"
                  method="POST">
                  <input type="submit" value="+"/> 
            </form>
        </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>

  <div id="sellers">
  <h3>For Sellers:</h3>
  <button onclick="scrolldiv('products')">Scroll to Product Feedback</button> 
  <table class='table table-hover table-bordered container' id='sortable_sellers'>
    <thead class="quokka-brown">
      <tr>
        <th scope="col">Seller's Name</th>
        <th scope="col">Rating</th>
        <th scope="col">Review</th>
        <th scope="col">Time Added or Updated</th>
        <th scope="col">Edit</th>
      </tr>
    </thead>
    <tbody>
      {% for item in sfeedback %}
        <tr>
          <td>
          <a href="{{ url_for('feedback.seller_personal', seller_id=item.sid)}}">{{ item.name }}</a>
          </td>
          <td>{{item.rating}}</td>
          <td>{{item.review}}</td>
          <td>{{humanize_time(item.date_time)}}</td>
          <td>
            <form action="{{ url_for('feedback.seller_feedback_edit', seller_id=item.sid) }}"
                  method="POST">
                  <input type="submit" value="+"/> 
            </form>
        </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your feedback!</p>

{% endif %}
  {% endblock %}
  
  
  